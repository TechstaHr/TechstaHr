{
    "info": {
        "name": "Timesheet E2E Tests - Updated",
        "_postman_id": "48762960-ced55caf-5e9c-4532-9291-143949272cee",
        "description": "Collection to test timesheet endpoints: clock-in, active, attach-screenshots, clock-out, submit, approve. Make sure to set valid environment variables.",
        "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
        { "key": "baseUrl", "value": "http://localhost:3000" },
        { "key": "token", "value": "<TOKEN>" },
        { "key": "adminToken", "value": "<ADMIN_TOKEN>" },
        { "key": "projectId", "value": "<PROJECT_ID>" },
        { "key": "entryId", "value": "" },
        { "key": "screenshotUrl", "value": "<SCREENSHOT_URL>" }
    ],
    "item": [
        {
            "name": "1 - Clock In",
            "request": {
                "method": "POST",
                "header": [
                    { "key": "Content-Type", "value": "application/json" },
                    { "key": "Authorization", "value": "Bearer {{token}}" }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{ \"projectId\": \"{{projectId}}\" }"
                },
                "url": {
                    "raw": "{{baseUrl}}/api/v1/time/clock-in",
                    "host": ["{{baseUrl}}"],
                    "path": ["api", "v1", "time", "clock-in"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "var status = pm.response.code;",
                            "pm.test('Clock-in returns 200 or 201', function () {",
                            "    pm.expect([200, 201]).to.include(status);",
                            "});",
                            "// Optionally save entryId for later requests if returned in response",
                            "if (pm.response.json().entryId) {",
                            "    pm.environment.set('entryId', pm.response.json().entryId);",
                            "}"
                        ],
                        "type": "text/javascript"
                    }
                }
            ]
        },
        {
            "name": "2 - Get Active Entry",
            "request": {
                "method": "GET",
                "header": [
                    { "key": "Authorization", "value": "Bearer {{token}}" }
                ],
                "url": {
                    "raw": "{{baseUrl}}/api/v1/time/active",
                    "host": ["{{baseUrl}}"],
                    "path": ["api", "v1", "time", "active"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('Get active returns 200', function () {",
                            "    pm.response.to.have.status(200);",
                            "});",
                            "// Save entryId from active entry if available",
                            "if (pm.response.json().entryId) {",
                            "    pm.environment.set('entryId', pm.response.json().entryId);",
                            "}"
                        ],
                        "type": "text/javascript"
                    }
                }
            ]
        },
        {
            "name": "3 - Attach Screenshots",
            "request": {
                "method": "POST",
                "header": [
                    { "key": "Content-Type", "value": "application/json" },
                    { "key": "Authorization", "value": "Bearer {{token}}" }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{ \"entryId\": \"{{entryId}}\", \"screenshots\": [\"{{screenshotUrl}}\"] }"
                },
                "url": {
                    "raw": "{{baseUrl}}/api/v1/time/attach-screenshots",
                    "host": ["{{baseUrl}}"],
                    "path": ["api", "v1", "time", "attach-screenshots"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('Attach screenshots returns 200', function () {",
                            "    pm.response.to.have.status(200);",
                            "});"
                        ],
                        "type": "text/javascript"
                    }
                }
            ]
        },
        {
            "name": "4 - Clock Out (with entryId)",
            "request": {
                "method": "POST",
                "header": [
                    { "key": "Content-Type", "value": "application/json" },
                    { "key": "Authorization", "value": "Bearer {{token}}" }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{ \"entryId\": \"{{entryId}}\" }"
                },
                "url": {
                    "raw": "{{baseUrl}}/api/v1/time/clock-out",
                    "host": ["{{baseUrl}}"],
                    "path": ["api", "v1", "time", "clock-out"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('Clock-out returns 200', function () {",
                            "    pm.response.to.have.status(200);",
                            "});"
                        ],
                        "type": "text/javascript"
                    }
                }
            ]
        },
        {
            "name": "5 - Submit Timesheet",
            "request": {
                "method": "POST",
                "header": [
                    { "key": "Content-Type", "value": "application/json" },
                    { "key": "Authorization", "value": "Bearer {{token}}" }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{ \"entryId\": \"{{entryId}}\" }"
                },
                "url": {
                    "raw": "{{baseUrl}}/api/v1/time/submit",
                    "host": ["{{baseUrl}}"],
                    "path": ["api", "v1", "time", "submit"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('Submit returns 200', function () {",
                            "    pm.response.to.have.status(200);",
                            "});"
                        ],
                        "type": "text/javascript"
                    }
                }
            ]
        },
        {
            "name": "6 - Approve Timesheet (admin)",
            "request": {
                "method": "POST",
                "header": [
                    { "key": "Content-Type", "value": "application/json" },
                    { "key": "Authorization", "value": "Bearer {{adminToken}}" }
                ],
                "body": {
                    "mode": "raw",
                    "raw": "{ \"entryId\": \"{{entryId}}\" }"
                },
                "url": {
                    "raw": "{{baseUrl}}/api/v1/time/approve",
                    "host": ["{{baseUrl}}"],
                    "path": ["api", "v1", "time", "approve"]
                }
            },
            "event": [
                {
                    "listen": "test",
                    "script": {
                        "exec": [
                            "pm.test('Approve returns 200', function () {",
                            "    pm.response.to.have.status(200);",
                            "});"
                        ],
                        "type": "text/javascript"
                    }
                }
            ]
        }
    ]
}